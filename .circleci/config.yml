version: 2.1

orbs:
  aws-cli: circleci/aws-cli@0.1.20
  secrethub: secrethub/cli@dev:5a9d572

jobs:
  myjob-shell:
    executor: aws-cli/default
    shell: secrethub run -- /bin/bash
    environment:
      AWS_DEFAULT_REGION: eu-west-1
    steps:
      - secrethub/install
      - checkout
      - run: echo $SHELL
      - run: env | grep AWS_SECRET_ACCESS_KEY
      - aws-cli/setup
  myjob-exec:
    docker:
      - image: cimg/base:2020.01
    steps:
      - checkout
      - secrethub/exec:
          command: |
            env | grep AWS_SECRET_ACCESS_KEY

workflows:
  main:
    jobs:
      - myjob-shell
      - myjob-exec
